<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Builder - æç¤ºè¯ç»„è£…å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4a90e2;
            --primary-hover: #357abd;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --text-dark: #333333;
            --text-light: #666666;
            --border-color: #dee2e6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--light-bg);
        }

        .navbar {
            background: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nav-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: var(--white);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        .btn-block {
            width: 100%;
        }

        .main-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: calc(100vh - 200px);
        }

        .step {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-container {
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        .step-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .step-header h1 {
            font-size: 2rem;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .step-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .input-section {
            margin-bottom: 40px;
        }

        .prompt-input {
            width: 100%;
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.1rem;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .prompt-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .tutorial-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
        }

        .tutorial-card h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .tutorial-card p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .tutorial-card ol {
            padding-left: 20px;
        }

        .tutorial-card li {
            margin-bottom: 10px;
            opacity: 0.95;
        }

        .examples-section {
            margin-bottom: 40px;
        }

        .examples-section h3 {
            margin-bottom: 20px;
            color: var(--text-dark);
            font-size: 1.3rem;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .example-item {
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .example-item:hover {
            border-color: var(--primary-color);
            background: var(--white);
            transform: translateY(-3px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .example-icon {
            font-size: 2rem;
        }

        .example-text {
            font-size: 1rem;
            color: var(--text-dark);
        }

        .recommendation-section {
            margin-bottom: 40px;
        }

        .scene-section,
        .goals-section {
            margin-bottom: 30px;
        }

        .scene-section h3,
        .goals-section h3 {
            margin-bottom: 15px;
            color: var(--text-dark);
            font-size: 1.2rem;
        }

        .scene-tag {
            display: inline-block;
            background: var(--primary-color);
            color: var(--white);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .scene-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .scene-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .goals-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .goal-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .goal-checkbox:hover {
            border-color: var(--primary-color);
            background: var(--white);
        }

        .goal-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .goal-checkbox span {
            font-size: 1rem;
            color: var(--text-dark);
        }

        .dimensions-section {
            margin-bottom: 40px;
        }

        .dimensions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .dimensions-header h3 {
            color: var(--text-dark);
            font-size: 1.2rem;
        }

        .dimensions-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .more-dimensions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed var(--border-color);
        }

        .dimension-item {
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .dimension-item:hover {
            border-color: var(--primary-color);
            background: var(--white);
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .dimension-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .help-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .help-btn:hover {
            background: var(--primary-hover);
            transform: scale(1.1);
        }

        .dimension-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .dimension-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .action-section {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .result-section {
            margin-bottom: 40px;
        }

        .short-name-section {
            margin-bottom: 30px;
        }

        .short-name-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .short-name-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .short-name-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .prompt-output {
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .prompt-output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--white);
            border-bottom: 2px solid var(--border-color);
        }

        .prompt-output-header h3 {
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .prompt-output-text {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: none;
            background: var(--light-bg);
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.8;
            resize: vertical;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
            gap: 20px;
            color: var(--white);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-dark);
            color: var(--white);
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3000;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1500;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--white);
            margin: 50px auto;
            max-width: 900px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
        }

        .modal-small {
            max-width: 500px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--text-dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding: 20px 30px;
            border-top: 2px solid var(--border-color);
        }

        .library-search {
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .library-content {
            max-height: 500px;
            overflow-y: auto;
        }

        .prompt-card {
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .prompt-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .prompt-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prompt-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .prompt-usage {
            font-size: 0.9rem;
            color: var(--text-light);
            background: var(--white);
            padding: 5px 12px;
            border-radius: 15px;
        }

        .prompt-card-body {
            margin-bottom: 15px;
        }

        .prompt-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .prompt-scene {
            background: var(--primary-color);
            color: var(--white);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .prompt-preview {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .prompt-card-footer {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .empty-state,
        .error-state,
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .footer {
            text-align: center;
            padding: 30px 20px;
            background: var(--white);
            border-top: 2px solid var(--border-color);
            color: var(--text-light);
        }

        .login-info {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .login-info p {
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .login-info .note {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-input {
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-actions {
            display: flex;
            gap: 10px;
        }

        .form-footer {
            text-align: center;
            margin-top: 10px;
        }

        .form-footer p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .step-container {
                padding: 20px;
            }

            .step-header h1 {
                font-size: 1.5rem;
            }

            .step-subtitle {
                font-size: 1rem;
            }

            .examples-grid {
                grid-template-columns: 1fr;
            }

            .dimensions-container {
                grid-template-columns: 1fr;
            }

            .action-section {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .modal-content {
                margin: 20px;
                max-width: none;
            }

            .prompt-card-footer {
                flex-direction: column;
            }

            .prompt-card-footer .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }

            .main-content {
                padding: 20px 10px;
            }

            .step-header h1 {
                font-size: 1.3rem;
            }

            .tutorial-card {
                padding: 20px;
            }

            .goals-list {
                flex-direction: column;
            }

            .goal-checkbox {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span>ğŸ”§</span>
                <span>Prompt Builder</span>
            </div>
            <div class="nav-actions">
                <button id="loginBtn" class="btn btn-secondary btn-sm">
                    <span>ğŸ”</span>
                    <span id="loginText">ç™»å½•</span>
                </button>
                <button id="libraryBtn" class="btn btn-secondary btn-sm">
                    <span>ğŸ“š</span>
                    æç¤ºè¯åº“
                </button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨ç”Ÿæˆ...</p>
        </div>

        <div id="toast" class="toast"></div>

        <div id="step1" class="step active">
            <div class="step-container">
                <div class="step-header">
                    <h1>æŠŠæ¨¡ç³Šéœ€æ±‚å˜æˆç»“æ„åŒ–æç¤ºè¯</h1>
                    <p class="step-subtitle">è¾“å…¥ä¸€å¥è¯ï¼ŒAIå¸®ä½ å®Œå–„ç»†èŠ‚</p>
                </div>

                <div class="input-section">
                    <textarea id="promptInput" class="prompt-input" placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘æŠŠè¿™æ®µé€šçŸ¥å†™å¾—æ›´æ­£å¼ï¼ˆ500å­—å†…ï¼‰" rows="3"></textarea>
                    <button id="generateBtn" class="btn btn-primary btn-large">
                        <span>âœ¨</span>
                        ä¸€é”®AIæ‡‚ä½ 
                    </button>
                </div>

                <div class="tutorial-card">
                    <h3>ğŸ“– ä½¿ç”¨æ•™ç¨‹</h3>
                    <p>ä¸‰æ­¥å®Œæˆæç¤ºè¯ç»„è£…ï¼š</p>
                    <ol>
                        <li>è¾“å…¥ä½ çš„åŸå§‹éœ€æ±‚ï¼ˆä¸€å¥è¯å³å¯ï¼‰</li>
                        <li>ç³»ç»Ÿæ¨èåœºæ™¯ã€ç›®æ ‡å’Œç»´åº¦ï¼Œä½ åªéœ€å¡«å†™</li>
                        <li>ç”Ÿæˆç»“æ„åŒ–æç¤ºè¯ï¼Œä¸€é”®ä¿å­˜åˆ°åº“</li>
                    </ol>
                </div>

                <div class="examples-section">
                    <h3>ğŸ’¡ ç¤ºä¾‹ï¼ˆç‚¹å‡»è‡ªåŠ¨å¡«å…¥ï¼‰</h3>
                    <div class="examples-grid">
                        <div class="example-item" data-example="å¸®æˆ‘æŠŠè¿™æ®µé€šçŸ¥å†™å¾—æ›´æ­£å¼ï¼ˆ500å­—å†…ï¼‰">
                            <span class="example-icon">ğŸ“</span>
                            <span class="example-text">æŠŠé€šçŸ¥å†™å¾—æ›´æ­£å¼ï¼ˆ500å­—å†…ï¼‰</span>
                        </div>
                        <div class="example-item" data-example="æŠŠä¼šè®®çºªè¦æ•´ç†æˆè¡¨æ ¼ï¼šè®®é¢˜/ç»“è®º/å¾…åŠ/è´Ÿè´£äºº">
                            <span class="example-icon">ğŸ“Š</span>
                            <span class="example-text">ä¼šè®®çºªè¦æ•´ç†æˆè¡¨æ ¼</span>
                        </div>
                        <div class="example-item" data-example="ç»™å®¶é•¿å†™ä¸€æ¡äº²åˆ‡çš„æ´»åŠ¨é€šçŸ¥ï¼Œåˆ«å¤ªå®˜æ–¹">
                            <span class="example-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                            <span class="example-text">ç»™å®¶é•¿å†™äº²åˆ‡çš„æ´»åŠ¨é€šçŸ¥</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="step2" class="step">
            <div class="step-container">
                <div class="step-header">
                    <button id="backToStep1" class="btn btn-secondary btn-sm">â† è¿”å›</button>
                    <h1>å®Œå–„æç¤ºè¯ç»´åº¦</h1>
                    <p class="step-subtitle">å¡«å†™æ¨èçš„ç»´åº¦ï¼Œè®©æç¤ºè¯æ›´ç²¾å‡†</p>
                </div>

                <div class="recommendation-section">
                    <div class="scene-section">
                        <h3>ğŸ¯ æ¨èåœºæ™¯</h3>
                        <div id="recommendedScene"></div>
                    </div>

                    <div class="goals-section">
                        <h3>ğŸ¯ æ¨èç›®æ ‡ï¼ˆå¯å¤šé€‰ï¼‰</h3>
                        <div id="recommendedGoals" class="goals-list"></div>
                    </div>
                </div>

                <div class="dimensions-section">
                    <div class="dimensions-header">
                        <h3>ğŸ“‹ ç»´åº¦å¡«å†™</h3>
                        <button id="toggleMoreDimensions" class="btn btn-link">
                            å±•å¼€æ›´å¤šç»´åº¦ (0)
                        </button>
                    </div>
                    <div id="dimensionsContainer" class="dimensions-container"></div>
                    <div id="moreDimensionsContainer" class="dimensions-container more-dimensions" style="display: none;"></div>
                </div>

                <div class="action-section">
                    <button id="regenerateBtn" class="btn btn-secondary">é‡æ–°ç”Ÿæˆ</button>
                    <button id="generatePromptBtn" class="btn btn-primary btn-large">
                        <span>âœ¨</span>
                        ç”Ÿæˆæç¤ºè¯
                    </button>
                </div>
            </div>
        </div>

        <div id="step3" class="step">
            <div class="step-container">
                <div class="step-header">
                    <button id="backToStep2" class="btn btn-secondary btn-sm">â† è¿”å›</button>
                    <h1>ç”ŸæˆæˆåŠŸï¼</h1>
                    <p class="step-subtitle">ä½ çš„ç»“æ„åŒ–æç¤ºè¯å·²å‡†å¤‡å¥½</p>
                </div>

                <div class="result-section">
                    <div class="short-name-section">
                        <label for="shortNameInput">ç®€ç§°ï¼ˆ8-12å­—ï¼‰</label>
                        <input type="text" id="shortNameInput" class="short-name-input" placeholder="ä¾‹å¦‚ï¼šåŠå…¬-å†™é€šçŸ¥-å…¬æ–‡">
                    </div>

                    <div class="prompt-output">
                        <div class="prompt-output-header">
                            <h3>ç»“æ„åŒ–æç¤ºè¯</h3>
                            <button id="copyPromptBtn" class="btn btn-secondary btn-sm">
                                <span>ğŸ“‹</span>
                                å¤åˆ¶
                            </button>
                        </div>
                        <textarea id="generatedPrompt" class="prompt-output-text" readonly></textarea>
                    </div>
                </div>

                <div class="action-section">
                    <button id="savePromptBtn" class="btn btn-primary btn-large">
                        <span>ğŸ’¾</span>
                        ä¿å­˜åˆ°æç¤ºè¯åº“
                    </button>
                    <button id="exportAllBtn" class="btn btn-secondary">
                        <span>ğŸ“¤</span>
                        å¯¼å‡ºå…¨éƒ¨
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div id="libraryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“š æç¤ºè¯åº“</h2>
                <button id="closeLibrary" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="library-search">
                    <input type="text" id="searchPrompts" class="search-input" placeholder="æœç´¢æç¤ºè¯...">
                </div>
                <div id="libraryContent" class="library-content">
                    <div class="loading-state">åŠ è½½ä¸­...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="exportAllBtnModal" class="btn btn-secondary">å¯¼å‡ºå…¨éƒ¨</button>
                <button id="closeLibraryBtn" class="btn btn-primary">å…³é—­</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>ğŸ” ç”¨æˆ·ç™»å½•</h2>
                <button id="closeLogin" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="login-info">
                    <p>ç™»å½•åå¯ä»¥å°†æç¤ºè¯ä¿å­˜åˆ°äº‘ç«¯ï¼Œå®ç°è·¨è®¾å¤‡åŒæ­¥ã€‚</p>
                    <p class="note">å½“å‰ç‰ˆæœ¬æ”¯æŒé‚®ç®±ç™»å½•ï¼Œæœªæ¥å°†æ”¯æŒQQä¸€é”®ç™»å½•ã€‚</p>
                </div>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="email">é‚®ç®±åœ°å€</label>
                        <input type="email" id="email" class="form-input" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required>
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç </label>
                        <input type="password" id="password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-block">ç™»å½•</button>
                    </div>
                    <div class="form-footer">
                        <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="#" id="registerLink">ç«‹å³æ³¨å†Œ</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>ğŸ“ ç”¨æˆ·æ³¨å†Œ</h2>
                <button id="closeRegister" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="login-info">
                    <p>æ³¨å†Œåå¯ä»¥å°†æç¤ºè¯ä¿å­˜åˆ°äº‘ç«¯ï¼Œå®ç°è·¨è®¾å¤‡åŒæ­¥ã€‚</p>
                    <p class="note">æ³¨å†Œå³è¡¨ç¤ºåŒæ„æˆ‘ä»¬çš„æœåŠ¡æ¡æ¬¾å’Œéšç§æ”¿ç­–ã€‚</p>
                </div>
                <form id="registerForm" class="login-form">
                    <div class="form-group">
                        <label for="regName">ç”¨æˆ·å</label>
                        <input type="text" id="regName" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">é‚®ç®±åœ°å€</label>
                        <input type="email" id="regEmail" class="form-input" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">å¯†ç </label>
                        <input type="password" id="regPassword" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="regConfirmPassword">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="regConfirmPassword" class="form-input" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required minlength="6">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-block">æ³¨å†Œ</button>
                    </div>
                    <div class="form-footer">
                        <p>å·²æœ‰è´¦å·ï¼Ÿ<a href="#" id="loginLink">ç«‹å³ç™»å½•</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Prompt Builder Â© 2025 | è®©AIæ›´æ‡‚ä½ çš„éœ€æ±‚</p>
    </footer>

    <script>
        const DIMENSIONS = {
            task: { name: 'ä»»åŠ¡/ç›®æ ‡', description: 'ä½ è¦AIåšä»€ä¹ˆ', benefit: 'é¿å…è·‘é¢˜', example: 'å†™ä¸€ä»½â€¦', placeholder: 'ä¾‹å¦‚ï¼šå†™ä¸€ä»½å·¥ä½œæ€»ç»“æŠ¥å‘Š' },
            deliverable: { name: 'äº¤ä»˜ç‰©', description: 'è¾“å‡ºé•¿ä»€ä¹ˆæ ·', benefit: 'ç»“æœå¯ç›´æ¥ç”¨', example: 'è¡¨æ ¼/é‚®ä»¶/æ–¹æ¡ˆ', placeholder: 'ä¾‹å¦‚ï¼šWordæ–‡æ¡£ï¼ŒåŒ…å«æ ‡é¢˜å’Œæ­£æ–‡' },
            role: { name: 'è§’è‰²', description: 'è®©AIæ‰®æ¼”è°', benefit: 'æ›´ä¸“ä¸š', example: 'è¡Œæ”¿å†™ä½œé¡¾é—®', placeholder: 'ä¾‹å¦‚ï¼šèµ„æ·±è¡Œæ”¿å†™ä½œä¸“å®¶' },
            scene: { name: 'åœºæ™¯/èƒŒæ™¯', description: 'å‘ç”Ÿåœ¨ä»€ä¹ˆæƒ…å¢ƒ', benefit: 'æ›´è´´åˆçœŸå®', example: 'ä¹¡é•‡é€šçŸ¥', placeholder: 'ä¾‹å¦‚ï¼šä¹¡é•‡æ”¿åºœå·¥ä½œåœºæ™¯' },
            input: { name: 'è¾“å…¥ææ–™', description: 'ä½ ç»™å®ƒä»€ä¹ˆ', benefit: 'å‡å°‘çç¼–', example: 'è¿™æ®µä¼šè®®çºªè¦', placeholder: 'ä¾‹å¦‚ï¼šä¼šè®®çºªè¦æ–‡æœ¬ã€æ•°æ®è¡¨æ ¼ç­‰' },
            scope: { name: 'èŒƒå›´è¾¹ç•Œ', description: 'åšä»€ä¹ˆ/ä¸åšä»€ä¹ˆ', benefit: 'æ›´å¯æ§', example: 'ä¸æ¶‰åŠæ³•å¾‹ç»“è®º', placeholder: 'ä¾‹å¦‚ï¼šä»…æ¶‰åŠæ—¥å¸¸å·¥ä½œï¼Œä¸æ¶‰åŠæ³•å¾‹é—®é¢˜' },
            format: { name: 'è¾“å‡ºæ ¼å¼', description: 'ç»“æ„/å­—æ®µ', benefit: 'æ›´æ˜“å¤åˆ¶', example: '1-2-3æ¡ç›®', placeholder: 'ä¾‹å¦‚ï¼šåˆ†ç‚¹åˆ—å‡ºï¼Œæ¯ç‚¹ä¸è¶…è¿‡100å­—' },
            constraints: { name: 'çº¦æŸæ¡ä»¶', description: 'å­—æ•°/æ—¶é—´/å£å»', benefit: 'ç¬¦åˆè¦æ±‚', example: '500å­—å†…', placeholder: 'ä¾‹å¦‚ï¼š500å­—ä»¥å†…ï¼Œæ­£å¼å…¬æ–‡é£æ ¼' },
            audience: { name: 'å—ä¼—', description: 'ç»™è°çœ‹', benefit: 'æ›´åˆé€‚', example: 'é¢†å¯¼/æ‘æ°‘/å®¶é•¿', placeholder: 'ä¾‹å¦‚ï¼šä¹¡é•‡é¢†å¯¼ã€æ‘å¹²éƒ¨' },
            style: { name: 'é£æ ¼è¯­æ°”', description: 'æ­£å¼/äº²åˆ‡', benefit: 'æ›´åƒäººå†™', example: 'é€šä¿—ä½†ä¸å£æ°´', placeholder: 'ä¾‹å¦‚ï¼šæ­£å¼ä½†ä¸ç”Ÿç¡¬ï¼Œäº²åˆ‡ä½†ä¸éšæ„' },
            steps: { name: 'è¿‡ç¨‹æ­¥éª¤', description: 'è¦ä¸è¦åˆ†æ­¥', benefit: 'å¯æ‰§è¡Œ', example: 'å…ˆåˆ—æçº²å†æˆç¨¿', placeholder: 'ä¾‹å¦‚ï¼šå…ˆåˆ—å‡ºæçº²ï¼Œå†é€æ­¥å±•å¼€' },
            quality: { name: 'è´¨é‡æ ‡å‡†', description: 'æ€ä¹ˆç®—å¥½', benefit: 'å¯éªŒæ”¶', example: 'å¿…é¡»å«3æ¡å»ºè®®', placeholder: 'ä¾‹å¦‚ï¼šå¿…é¡»åŒ…å«è‡³å°‘3æ¡å…·ä½“å»ºè®®' },
            interaction: { name: 'äº¤äº’åç»­', description: 'éœ€ä¸éœ€è¦è¿½é—®', benefit: 'å‡å°‘è¿”å·¥', example: 'ç¼ºä¿¡æ¯å…ˆé—®æˆ‘3ä¸ªé—®é¢˜', placeholder: 'ä¾‹å¦‚ï¼šå¦‚æœä¿¡æ¯ä¸è¶³ï¼Œè¯·å…ˆè¯¢é—®3ä¸ªé—®é¢˜' },
            environment: { name: 'å·¥å…·ç¯å¢ƒ', description: 'åœ¨å“ªç”¨', benefit: 'æ›´è½åœ°', example: 'é€‚é…WPS/Word', placeholder: 'ä¾‹å¦‚ï¼šé€‚é…WPSæ–‡æ¡£æ ¼å¼' }
        };

        const SCENES = {
            office: { name: 'åŠå…¬è¡Œæ”¿', keywords: ['é€šçŸ¥', 'æŠ¥å‘Š', 'æ€»ç»“', 'æ–¹æ¡ˆ', 'å…¬æ–‡', 'ä¼šè®®', 'å·¥ä½œ'], goals: ['æ’°å†™å…¬æ–‡', 'æ•´ç†ä¼šè®®çºªè¦', 'åˆ¶å®šå·¥ä½œæ–¹æ¡ˆ', 'æ’°å†™å·¥ä½œæ€»ç»“'] },
            marketing: { name: 'è¥é”€æ¨å¹¿', keywords: ['å®£ä¼ ', 'æ¨å¹¿', 'å¹¿å‘Š', 'æ–‡æ¡ˆ', 'æ´»åŠ¨', 'è¥é”€'], goals: ['æ’°å†™å®£ä¼ æ–‡æ¡ˆ', 'è®¾è®¡æ´»åŠ¨æ–¹æ¡ˆ', 'æ’°å†™äº§å“ä»‹ç»', 'æ’°å†™æ¨å¹¿æ–‡æ¡ˆ'] },
            education: { name: 'æ•™è‚²åŸ¹è®­', keywords: ['æ•™å­¦', 'åŸ¹è®­', 'è¯¾ç¨‹', 'å­¦ä¹ ', 'æ•™è‚²', 'è®²è§£'], goals: ['ç¼–å†™æ•™å­¦å¤§çº²', 'è®¾è®¡åŸ¹è®­è¯¾ç¨‹', 'æ’°å†™æ•™å­¦ææ–™', 'è§£ç­”å­¦ä¹ é—®é¢˜'] },
            agriculture: { name: 'å†œä¸šç”Ÿäº§', keywords: ['ç§æ¤', 'å†œä¸š', 'å…»æ®–', 'å†œäº§å“', 'å†œæŠ€', 'èŠ’æœ'], goals: ['æä¾›ç§æ¤å»ºè®®', 'è§£ç­”å†œä¸šé—®é¢˜', 'æ’°å†™å†œæŠ€æŒ‡å¯¼', 'åˆ†æå†œäº§å“å¸‚åœº'] },
            daily: { name: 'æ—¥å¸¸ç”Ÿæ´»', keywords: ['ç”Ÿæ´»', 'æ—¥å¸¸', 'å®¶åº­', 'ä¸ªäºº', 'ç¤¾äº¤'], goals: ['æ’°å†™æ—¥å¸¸æ–‡æ¡ˆ', 'æä¾›ç”Ÿæ´»å»ºè®®', 'å¤„ç†æ—¥å¸¸äº‹åŠ¡', 'æ’°å†™ç¤¾äº¤æ–‡æ¡ˆ'] },
            technical: { name: 'æŠ€æœ¯æ–‡æ¡£', keywords: ['æŠ€æœ¯', 'æ–‡æ¡£', 'ä»£ç ', 'å¼€å‘', 'ç³»ç»Ÿ', 'è½¯ä»¶'], goals: ['ç¼–å†™æŠ€æœ¯æ–‡æ¡£', 'æ’°å†™ä»£ç æ³¨é‡Š', 'è®¾è®¡ç³»ç»Ÿæ–¹æ¡ˆ', 'ç¼–å†™APIæ–‡æ¡£'] }
        };

        const DEFAULT_DIMENSIONS = ['task', 'deliverable', 'role', 'scene', 'input', 'format'];

        let currentStep = 1;
        let currentPromptData = {};
        let selectedGoals = [];
        let prompts = [];
        let currentUser = null;

        function getRecommendedScene(input) {
            const lowerInput = input.toLowerCase();
            for (const [key, scene] of Object.entries(SCENES)) {
                for (const keyword of scene.keywords) {
                    if (lowerInput.includes(keyword.toLowerCase())) {
                        return { key, ...scene };
                    }
                }
            }
            return { key: 'office', ...SCENES.office };
        }

        function getRecommendedGoals(sceneKey) {
            const scene = SCENES[sceneKey];
            return scene ? scene.goals : SCENES.office.goals;
        }

        function getRecommendedDimensions(input, sceneKey) {
            const lowerInput = input.toLowerCase();
            let dimensions = [...DEFAULT_DIMENSIONS];

            if (lowerInput.includes('å­—') || lowerInput.includes('å­—æ•°')) {
                dimensions.push('constraints');
            }
            if (lowerInput.includes('é¢†å¯¼') || lowerInput.includes('æ‘æ°‘') || lowerInput.includes('å®¶é•¿')) {
                dimensions.push('audience');
            }
            if (lowerInput.includes('æ­£å¼') || lowerInput.includes('äº²åˆ‡') || lowerInput.includes('é£æ ¼')) {
                dimensions.push('style');
            }
            if (lowerInput.includes('æçº²') || lowerInput.includes('æ­¥éª¤')) {
                dimensions.push('steps');
            }

            return [...new Set(dimensions)];
        }

        function generateShortName(scene, task, deliverable) {
            const sceneName = scene.substring(0, 2);
            const taskName = task.substring(0, 4);
            const deliverableName = deliverable.substring(0, 4);
            
            let shortName = sceneName + '-' + taskName + '-' + deliverableName;
            if (shortName.length > 12) {
                shortName = shortName.substring(0, 12);
            }
            
            return shortName;
        }

        function generateStructuredPrompt(data) {
            let prompt = '';
            
            if (data.role) {
                prompt += 'ã€è§’è‰²è®¾å®šã€‘\n' + data.role + '\n\n';
            }
            
            if (data.scene) {
                prompt += 'ã€åœºæ™¯èƒŒæ™¯ã€‘\n' + data.scene + '\n\n';
            }
            
            if (data.task) {
                prompt += 'ã€ä»»åŠ¡ç›®æ ‡ã€‘\n' + data.task + '\n\n';
            }
            
            if (data.input) {
                prompt += 'ã€è¾“å…¥ææ–™ã€‘\n' + data.input + '\n\n';
            }
            
            if (data.deliverable) {
                prompt += 'ã€äº¤ä»˜è¦æ±‚ã€‘\n' + data.deliverable + '\n\n';
            }
            
            if (data.scope) {
                prompt += 'ã€èŒƒå›´è¾¹ç•Œã€‘\n' + data.scope + '\n\n';
            }
            
            if (data.format) {
                prompt += 'ã€è¾“å‡ºæ ¼å¼ã€‘\n' + data.format + '\n\n';
            }
            
            if (data.constraints) {
                prompt += 'ã€çº¦æŸæ¡ä»¶ã€‘\n' + data.constraints + '\n\n';
            }
            
            if (data.audience) {
                prompt += 'ã€ç›®æ ‡å—ä¼—ã€‘\n' + data.audience + '\n\n';
            }
            
            if (data.style) {
                prompt += 'ã€é£æ ¼è¯­æ°”ã€‘\n' + data.style + '\n\n';
            }
            
            if (data.steps) {
                prompt += 'ã€æ‰§è¡Œæ­¥éª¤ã€‘\n' + data.steps + '\n\n';
            }
            
            if (data.quality) {
                prompt += 'ã€è´¨é‡æ ‡å‡†ã€‘\n' + data.quality + '\n\n';
            }
            
            if (data.interaction) {
                prompt += 'ã€äº¤äº’è¦æ±‚ã€‘\n' + data.interaction + '\n\n';
            }
            
            if (data.environment) {
                prompt += 'ã€ä½¿ç”¨ç¯å¢ƒã€‘\n' + data.environment + '\n\n';
            }
            
            prompt += 'è¯·æŒ‰ç…§ä»¥ä¸Šè¦æ±‚å®Œæˆä»»åŠ¡ã€‚';
            
            return prompt;
        }

        function showStep(step) {
            currentStep = step;
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            const stepElement = document.getElementById('step' + step);
            if (stepElement) {
                stepElement.classList.add('active');
                if (step === 1) {
                    const promptInput = document.getElementById('promptInput');
                    if (promptInput) promptInput.focus();
                } else if (step === 2) {
                    const promptInput = document.getElementById('promptInput');
                    if (promptInput) promptInput.blur();
                }
            }
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = show ? 'flex' : 'none';
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        function handleGenerate() {
            const input = document.getElementById('promptInput');
            if (!input) {
                alert('æ‰¾ä¸åˆ°è¾“å…¥æ¡†');
                return;
            }

            const inputValue = input.value.trim();
            if (!inputValue) {
                alert('è¯·è¾“å…¥æç¤ºè¯å†…å®¹');
                return;
            }

            showLoading(true);

            try {
                const scene = getRecommendedScene(inputValue);
                const goals = getRecommendedGoals(scene.key);
                const recommendedDimensions = getRecommendedDimensions(inputValue, scene.key);

                currentPromptData = {
                    originalInput: inputValue,
                    scene: scene.name,
                    sceneKey: scene.key
                };

                displayScene(scene);
                displayGoals(goals);
                displayDimensions(recommendedDimensions);

                showStep(2);
            } catch (error) {
                console.error('Generate error:', error);
                alert('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ï¼š' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayScene(scene) {
            const sceneElement = document.getElementById('recommendedScene');
            if (sceneElement) {
                sceneElement.innerHTML = `
                    <div class="scene-tag">${scene.name}</div>
                    <input type="text" id="sceneInput" value="${scene.name}" class="scene-input" placeholder="ä¿®æ”¹åœºæ™¯æ ‡ç­¾">
                `;
            }
        }

        function displayGoals(goals) {
            const goalsElement = document.getElementById('recommendedGoals');
            if (goalsElement) {
                goalsElement.innerHTML = goals.map((goal, index) => `
                    <label class="goal-checkbox">
                        <input type="checkbox" value="${goal}" ${index === 0 ? 'checked' : ''}>
                        <span>${goal}</span>
                    </label>
                `).join('');

                selectedGoals = [goals[0]];

                goalsElement.querySelectorAll('input').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            selectedGoals.push(e.target.value);
                        } else {
                            selectedGoals = selectedGoals.filter(g => g !== e.target.value);
                        }
                    });
                });
            }
        }

        function displayDimensions(dimensions) {
            const container = document.getElementById('dimensionsContainer');
            const moreContainer = document.getElementById('moreDimensionsContainer');
            const allDimensions = Object.keys(DIMENSIONS);
            const moreDimensions = allDimensions.filter(d => !dimensions.includes(d));

            if (container) {
                container.innerHTML = dimensions.map(key => createDimensionForm(key, DIMENSIONS[key])).join('');
            }

            if (moreContainer) {
                moreContainer.innerHTML = moreDimensions.map(key => createDimensionForm(key, DIMENSIONS[key])).join('');
            }

            const toggleBtn = document.getElementById('toggleMoreDimensions');
            if (toggleBtn) {
                toggleBtn.textContent = 'å±•å¼€æ›´å¤šç»´åº¦ (' + moreDimensions.length + ')';
            }
        }

        function createDimensionForm(key, dimension) {
            return `
                <div class="dimension-item" data-key="${key}">
                    <div class="dimension-header">
                        <label class="dimension-label">${dimension.name}</label>
                        <button class="help-btn" onclick="showDimensionHelp('${key}')" title="æŸ¥çœ‹å¸®åŠ©">?</button>
                    </div>
                    <input type="text" 
                           class="dimension-input" 
                           id="dim_${key}" 
                           placeholder="${dimension.placeholder}"
                           onchange="updatePromptData('${key}', this.value)">
                </div>
            `;
        }

        function showDimensionHelp(key) {
            const dimension = DIMENSIONS[key];
            if (dimension) {
                alert(dimension.name + '\n\n' + dimension.description + '\n\nå¥½å¤„ï¼š' + dimension.benefit + '\n\nç¤ºä¾‹ï¼š' + dimension.example);
            }
        }

        function updatePromptData(key, value) {
            currentPromptData[key] = value;
        }

        function toggleMoreDimensions() {
            const container = document.getElementById('moreDimensionsContainer');
            const btn = document.getElementById('toggleMoreDimensions');
            
            if (container && btn) {
                if (container.style.display === 'none' || !container.style.display) {
                    container.style.display = 'block';
                    btn.textContent = 'æ”¶èµ·æ›´å¤šç»´åº¦';
                } else {
                    container.style.display = 'none';
                    btn.textContent = 'å±•å¼€æ›´å¤šç»´åº¦ (8)';
                }
            }
        }

        function handleGeneratePrompt() {
            collectDimensionData();

            if (!currentPromptData.task) {
                alert('è¯·è‡³å°‘å¡«å†™"ä»»åŠ¡/ç›®æ ‡"ç»´åº¦');
                return;
            }

            showLoading(true);

            try {
                const structuredPrompt = generateStructuredPrompt(currentPromptData);
                const shortName = generateShortName(
                    currentPromptData.scene || '',
                    currentPromptData.task || '',
                    currentPromptData.deliverable || ''
                );

                currentPromptData.structuredPrompt = structuredPrompt;
                currentPromptData.shortName = shortName;
                currentPromptData.name = shortName;
                currentPromptData.tags = [currentPromptData.sceneKey || 'default'];
                currentPromptData.createdAt = new Date().toISOString();
                currentPromptData.usageCount = 0;

                displayGeneratedPrompt(structuredPrompt, shortName);
                showStep(3);
            } catch (error) {
                console.error('Generate prompt error:', error);
                alert('ç”Ÿæˆæç¤ºè¯å¤±è´¥ï¼Œè¯·é‡è¯•ï¼š' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function collectDimensionData() {
            const inputs = document.querySelectorAll('.dimension-input');
            inputs.forEach(input => {
                const key = input.id.replace('dim_', '');
                if (input.value.trim()) {
                    currentPromptData[key] = input.value.trim();
                }
            });

            const sceneInput = document.getElementById('sceneInput');
            if (sceneInput && sceneInput.value.trim()) {
                currentPromptData.scene = sceneInput.value.trim();
            }

            if (selectedGoals.length > 0) {
                currentPromptData.goals = selectedGoals;
            }
        }

        function displayGeneratedPrompt(prompt, shortName) {
            const promptElement = document.getElementById('generatedPrompt');
            const shortNameInput = document.getElementById('shortNameInput');
            
            if (promptElement) {
                promptElement.value = prompt;
            }
            if (shortNameInput) {
                shortNameInput.value = shortName;
            }
        }

        function handleCopyPrompt() {
            const promptElement = document.getElementById('generatedPrompt');
            if (!promptElement) {
                alert('æ‰¾ä¸åˆ°æç¤ºè¯è¾“å‡ºåŒºåŸŸ');
                return;
            }

            const prompt = promptElement.value;
            
            try {
                navigator.clipboard.writeText(prompt).then(() => {
                    showToast('æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(err => {
                    console.error('Copy failed:', err);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                });
            } catch (error) {
                console.error('Copy error:', error);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }
        }

        function handleSavePrompt() {
            collectDimensionData();

            const shortNameInput = document.getElementById('shortNameInput');
            if (!shortNameInput) {
                alert('æ‰¾ä¸åˆ°ç®€ç§°è¾“å…¥æ¡†');
                return;
            }

            const shortName = shortNameInput.value.trim();
            if (!shortName) {
                alert('è¯·è¾“å…¥ç®€ç§°');
                return;
            }

            currentPromptData.shortName = shortName;
            currentPromptData.name = shortName;

            try {
                currentPromptData.id = Date.now();
                prompts.push(currentPromptData);
                localStorage.setItem('promptBuilderPrompts', JSON.stringify(prompts));
                showToast('æç¤ºè¯å·²ä¿å­˜åˆ°åº“');
                updateLibraryUI();
            } catch (error) {
                console.error('Save error:', error);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼š' + error.message);
            }
        }

        function openLibrary() {
            const modal = document.getElementById('libraryModal');
            if (modal) {
                modal.style.display = 'block';
                updateLibraryUI();
            }
        }

        function closeLibrary() {
            const modal = document.getElementById('libraryModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function updateLibraryUI() {
            const container = document.getElementById('libraryContent');
            const searchInput = document.getElementById('searchPrompts');
            
            if (!container) {
                return;
            }

            const searchValue = searchInput ? searchInput.value.trim() : '';

            try {
                let filteredPrompts = prompts;
                if (searchValue) {
                    const lowerSearch = searchValue.toLowerCase();
                    filteredPrompts = prompts.filter(p => {
                        const nameMatch = p.name && p.name.toLowerCase().includes(lowerSearch);
                        const sceneMatch = p.scene && p.scene.toLowerCase().includes(lowerSearch);
                        const taskMatch = p.task && p.task.toLowerCase().includes(lowerSearch);
                        return nameMatch || sceneMatch || taskMatch;
                    });
                }

                if (filteredPrompts.length === 0) {
                    container.innerHTML = '<div class="empty-state">æš‚æ— æç¤ºè¯</div>';
                    return;
                }

                container.innerHTML = filteredPrompts.map(prompt => createPromptCard(prompt)).join('');

                container.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const promptId = parseInt(e.target.dataset.id);
                        copyPromptToClipboard(promptId);
                    });
                });

                container.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const promptId = parseInt(e.target.dataset.id);
                        editPrompt(promptId);
                    });
                });

                container.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const promptId = parseInt(e.target.dataset.id);
                        deletePromptFromLibrary(promptId);
                    });
                });
            } catch (error) {
                console.error('Update library error:', error);
                container.innerHTML = '<div class="error-state">åŠ è½½å¤±è´¥ï¼š' + error.message + '</div>';
            }
        }

        function createPromptCard(prompt) {
            return `
                <div class="prompt-card">
                    <div class="prompt-card-header">
                        <h3 class="prompt-name">${prompt.name || 'æœªå‘½å'}</h3>
                        <span class="prompt-usage">ä½¿ç”¨ ${prompt.usageCount || 0} æ¬¡</span>
                    </div>
                    <div class="prompt-card-body">
                        <div class="prompt-info">
                            <span class="prompt-scene">${prompt.scene || ''}</span>
                            ${prompt.tags && prompt.tags.length > 0 ? `
                                <div class="prompt-tags">
                                    ${prompt.tags.map(tag => `<span class="prompt-scene">${tag}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                        <p class="prompt-preview">${(prompt.task || '').substring(0, 100)}...</p>
                    </div>
                    <div class="prompt-card-footer">
                        <button class="btn btn-sm copy-btn" data-id="${prompt.id}">å¤åˆ¶</button>
                        <button class="btn btn-sm edit-btn" data-id="${prompt.id}">ç¼–è¾‘</button>
                        <button class="btn btn-sm delete-btn" data-id="${prompt.id}" style="background: var(--danger-color);">åˆ é™¤</button>
                    </div>
                </div>
            `;
        }

        function copyPromptToClipboard(id) {
            try {
                const prompt = prompts.find(p => p.id === id);
                if (prompt && prompt.structuredPrompt) {
                    navigator.clipboard.writeText(prompt.structuredPrompt).then(() => {
                        prompt.usageCount = (prompt.usageCount || 0) + 1;
                        localStorage.setItem('promptBuilderPrompts', JSON.stringify(prompts));
                        showToast('æç¤ºè¯å·²å¤åˆ¶');
                        updateLibraryUI();
                    }).catch(err => {
                        console.error('Copy failed:', err);
                        alert('å¤åˆ¶å¤±è´¥ï¼š' + err.message);
                    });
                }
            } catch (error) {
                console.error('Copy prompt error:', error);
                alert('å¤åˆ¶å¤±è´¥ï¼š' + error.message);
            }
        }

        function editPrompt(id) {
            try {
                const prompt = prompts.find(p => p.id === id);
                if (prompt) {
                    currentPromptData = { ...prompt };
                    const promptInput = document.getElementById('promptInput');
                    if (promptInput) {
                        promptInput.value = prompt.originalInput || '';
                    }
                    closeLibrary();
                    showStep(1);
                    handleGenerate();
                }
            } catch (error) {
                console.error('Edit prompt error:', error);
                alert('åŠ è½½å¤±è´¥ï¼š' + error.message);
            }
        }

        function deletePromptFromLibrary(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ')) {
                return;
            }

            try {
                prompts = prompts.filter(p => p.id !== id);
                localStorage.setItem('promptBuilderPrompts', JSON.stringify(prompts));
                showToast('å·²åˆ é™¤');
                updateLibraryUI();
            } catch (error) {
                console.error('Delete prompt error:', error);
                alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
            }
        }

        function handleExportAll() {
            try {
                if (prompts.length === 0) {
                    alert('æç¤ºè¯åº“ä¸ºç©º');
                    return;
                }

                const format = prompt('é€‰æ‹©å¯¼å‡ºæ ¼å¼:\n1. JSON\n2. CSV\n3. Markdown\n4. Excel\n\nè¯·è¾“å…¥æ•°å­—(1-4):');
                
                switch (format) {
                    case '1':
                        exportToJSON();
                        break;
                    case '2':
                        exportToCSV();
                        break;
                    case '3':
                        exportToMarkdown();
                        break;
                    case '4':
                        alert('Excelå¯¼å‡ºéœ€è¦xlsxåº“ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒJSON/CSV/Markdownå¯¼å‡º');
                        break;
                    default:
                        alert('æ— æ•ˆçš„é€‰æ‹©');
                }
            } catch (error) {
                console.error('Export all error:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
            }
        }

        function exportToJSON() {
            const dataStr = JSON.stringify(prompts, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'prompts.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function exportToCSV() {
            if (!prompts || prompts.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            const headers = ['åç§°', 'ç®€ç§°', 'åœºæ™¯', 'ä»»åŠ¡', 'äº¤ä»˜ç‰©', 'è§’è‰²', 'æ ‡ç­¾', 'ä½¿ç”¨æ¬¡æ•°', 'åˆ›å»ºæ—¶é—´'];
            const rows = prompts.map(prompt => [
                prompt.name || '',
                prompt.shortName || '',
                prompt.scene || '',
                prompt.task || '',
                prompt.deliverable || '',
                prompt.role || '',
                (prompt.tags || []).join('; '),
                prompt.usageCount || 0,
                prompt.createdAt || ''
            ]);

            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                const escapedRow = row.map(cell => {
                    const cellStr = String(cell);
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return '"' + cellStr.replace(/"/g, '""') + '"';
                    }
                    return cellStr;
                });
                csvContent += escapedRow.join(',') + '\n';
            });

            const BOM = '\uFEFF';
            const dataBlob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'prompts.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function exportToMarkdown() {
            if (!prompts || prompts.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            let mdContent = '# æç¤ºè¯åº“\n\n';
            mdContent += 'å¯¼å‡ºæ—¶é—´: ' + new Date().toLocaleString() + '\n';
            mdContent += 'æ€»è®¡: ' + prompts.length + ' ä¸ªæç¤ºè¯\n\n---\n\n';

            prompts.forEach((prompt, index) => {
                mdContent += '## ' + (index + 1) + '. ' + (prompt.name || 'æœªå‘½å') + '\n\n';
                
                if (prompt.shortName) {
                    mdContent += '**ç®€ç§°**: ' + prompt.shortName + '\n\n';
                }
                
                if (prompt.scene) {
                    mdContent += '**åœºæ™¯**: ' + prompt.scene + '\n\n';
                }
                
                if (prompt.tags && prompt.tags.length > 0) {
                    mdContent += '**æ ‡ç­¾**: ' + prompt.tags.join(', ') + '\n\n';
                }
                
                mdContent += '**ä½¿ç”¨æ¬¡æ•°**: ' + (prompt.usageCount || 0) + '\n\n';
                mdContent += '**åˆ›å»ºæ—¶é—´**: ' + (prompt.createdAt || '') + '\n\n';
                
                mdContent += '### ç»“æ„åŒ–æç¤ºè¯\n\n';
                mdContent += '```\n';
                mdContent += prompt.structuredPrompt || '';
                mdContent += '\n```\n\n';
                
                if (prompt.originalInput) {
                    mdContent += '### åŸå§‹è¾“å…¥\n\n';
                    mdContent += '> ' + prompt.originalInput + '\n\n';
                }
                
                mdContent += '---\n\n';
            });

            const dataBlob = new Blob([mdContent], { type: 'text/markdown;charset=utf-8;' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'prompts.md';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function handleLoginClick() {
            if (currentUser) {
                if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                    logout();
                }
            } else {
                openLoginModal();
            }
        }

        function openLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'block';
            }
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function handleLoginSubmit(event) {
            event.preventDefault();
            
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            
            if (!emailInput || !passwordInput) {
                alert('æ‰¾ä¸åˆ°ç™»å½•è¡¨å•');
                return;
            }

            const email = emailInput.value.trim();
            const password = passwordInput.value;
            
            if (!email || !password) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ç™»å½•ä¿¡æ¯');
                return;
            }

            currentUser = {
                id: Date.now(),
                email: email,
                name: email.split('@')[0],
                token: 'local_' + Date.now(),
                isLocal: true
            };

            localStorage.setItem('promptBuilderUser', JSON.stringify(currentUser));
            updateLoginUI();
            showToast('ç™»å½•æˆåŠŸï¼ˆæœ¬åœ°æ¨¡å¼ï¼‰');
            closeLoginModal();
        }

        function openRegisterModal() {
            const modal = document.getElementById('registerModal');
            if (modal) {
                modal.style.display = 'block';
            }
        }

        function closeRegisterModal() {
            const modal = document.getElementById('registerModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function openLoginModalFromRegister() {
            closeRegisterModal();
            openLoginModal();
        }

        function handleRegisterSubmit(event) {
            event.preventDefault();
            
            const nameInput = document.getElementById('regName');
            const emailInput = document.getElementById('regEmail');
            const passwordInput = document.getElementById('regPassword');
            const confirmPasswordInput = document.getElementById('regConfirmPassword');
            
            if (!nameInput || !emailInput || !passwordInput || !confirmPasswordInput) {
                alert('æ‰¾ä¸åˆ°æ³¨å†Œè¡¨å•');
                return;
            }

            const name = nameInput.value.trim();
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (!name || !email || !password || !confirmPassword) {
                alert('è¯·å¡«å†™å®Œæ•´çš„æ³¨å†Œä¿¡æ¯');
                return;
            }

            if (password.length < 6) {
                alert('å¯†ç è‡³å°‘éœ€è¦6ä½');
                return;
            }

            if (password !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }

            currentUser = {
                id: Date.now(),
                email: email,
                name: name,
                token: 'local_' + Date.now(),
                isLocal: true
            };

            localStorage.setItem('promptBuilderUser', JSON.stringify(currentUser));
            updateLoginUI();
            showToast('æ³¨å†ŒæˆåŠŸï¼ˆæœ¬åœ°æ¨¡å¼ï¼‰');
            closeRegisterModal();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('promptBuilderUser');
            updateLoginUI();
            showToast('å·²é€€å‡ºç™»å½•');
        }

        function updateLoginUI() {
            const loginText = document.getElementById('loginText');
            const loginBtn = document.getElementById('loginBtn');

            if (currentUser) {
                if (loginText) {
                    loginText.textContent = currentUser.email || currentUser.name;
                }
                if (loginBtn) {
                    loginBtn.classList.remove('btn-secondary');
                    loginBtn.classList.add('btn-success');
                }
            } else {
                if (loginText) {
                    loginText.textContent = 'ç™»å½•';
                }
                if (loginBtn) {
                    loginBtn.classList.remove('btn-success');
                    loginBtn.classList.add('btn-secondary');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedPrompts = localStorage.getItem('promptBuilderPrompts');
            if (savedPrompts) {
                try {
                    prompts = JSON.parse(savedPrompts);
                } catch (error) {
                    console.error('Failed to parse prompts:', error);
                    prompts = [];
                }
            }

            const savedUser = localStorage.getItem('promptBuilderUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    updateLoginUI();
                } catch (error) {
                    console.error('Failed to parse user:', error);
                }
            }

            document.getElementById('generateBtn').addEventListener('click', handleGenerate);
            document.getElementById('backToStep1').addEventListener('click', () => showStep(1));
            document.getElementById('regenerateBtn').addEventListener('click', handleGenerate);
            document.getElementById('copyPromptBtn').addEventListener('click', handleCopyPrompt);
            document.getElementById('savePromptBtn').addEventListener('click', handleSavePrompt);
            document.getElementById('exportAllBtn').addEventListener('click', handleExportAll);
            document.getElementById('libraryBtn').addEventListener('click', openLibrary);
            document.getElementById('closeLibrary').addEventListener('click', closeLibrary);
            document.getElementById('closeLibraryBtn').addEventListener('click', closeLibrary);
            document.getElementById('searchPrompts').addEventListener('input', updateLibraryUI);
            document.getElementById('toggleMoreDimensions').addEventListener('click', toggleMoreDimensions);
            document.getElementById('loginBtn').addEventListener('click', handleLoginClick);
            document.getElementById('closeLogin').addEventListener('click', closeLoginModal);
            document.getElementById('loginForm').addEventListener('submit', handleLoginSubmit);
            document.getElementById('registerLink').addEventListener('click', openRegisterModal);
            document.getElementById('closeRegister').addEventListener('click', closeRegisterModal);
            document.getElementById('registerForm').addEventListener('submit', handleRegisterSubmit);
            document.getElementById('loginLink').addEventListener('click', openLoginModalFromRegister);
            document.getElementById('backToStep2').addEventListener('click', () => showStep(2));
            document.getElementById('generatePromptBtn').addEventListener('click', handleGeneratePrompt);

            const examples = document.querySelectorAll('.example-item');
            examples.forEach(example => {
                example.addEventListener('click', () => {
                    const input = example.dataset.example;
                    const promptInput = document.getElementById('promptInput');
                    if (promptInput) {
                        promptInput.value = input;
                        handleGenerate();
                    }
                });
            });

            showStep(1);
        });

        window.onclick = function(event) {
            const libraryModal = document.getElementById('libraryModal');
            const loginModal = document.getElementById('loginModal');
            const registerModal = document.getElementById('registerModal');
            
            if (event.target === libraryModal) {
                closeLibrary();
            }
            if (event.target === loginModal) {
                closeLoginModal();
            }
            if (event.target === registerModal) {
                closeRegisterModal();
            }
        };
    </script>
</body>
</html>